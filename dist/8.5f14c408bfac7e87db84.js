(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"3tZb":function(e,_,t){e.exports=t.p+"54ef72d9c775a1af9958793b4826a652.png"},"9mub":function(e,_,t){e.exports=t.p+"3b4fb553d4df479dec72136bf89dd95e.png"},EBIn:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){__webpack_require__.d(__webpack_exports__,"default",function(){return ProtraitApp});var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("o0o1"),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("lwsE"),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("W8MJ"),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a1gu"),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Nsbk"),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4__),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("7W2i"),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_5__),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("q1tI"),react__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_6__),slucky_src_component_toast__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("phJ6"),slucky_src_component_lrChange__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("jOWV"),_protraitApp_scss__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("nlqJ"),_protraitApp_scss__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_protraitApp_scss__WEBPACK_IMPORTED_MODULE_9__),enterModule;enterModule=__webpack_require__("0cfB").enterModule,enterModule&&enterModule(module);var CANVANS_SIZE=256,ProtraitApp=function(_Component){function ProtraitApp(){var e;_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default()(this,ProtraitApp),e=_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3___default()(this,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_4___default()(ProtraitApp).call(this));var _=[{source:__webpack_require__("FVwy"),style:{width:128,height:128,top:"".concat(CANVANS_SIZE-128),left:"".concat(CANVANS_SIZE-128)}},{source:__webpack_require__("TiSE"),style:{width:128,height:128,top:"".concat(CANVANS_SIZE-138),left:"".concat(CANVANS_SIZE-118)}},{source:__webpack_require__("Wq8K"),style:{width:96,height:128,top:"".concat(CANVANS_SIZE-128),left:"".concat(CANVANS_SIZE-96)}},{source:__webpack_require__("3tZb"),style:{width:CANVANS_SIZE,height:96,top:-8,left:0}},{source:__webpack_require__("9mub"),style:{width:128,height:120,top:"".concat(CANVANS_SIZE-120),left:"".concat(CANVANS_SIZE-128)}},{source:__webpack_require__("lmTN"),style:{width:128,height:128,top:"".concat(CANVANS_SIZE-128),left:"".concat(CANVANS_SIZE-128)}},{source:"",style:{width:0,height:0,top:0,left:0}}];return e.state={sourceImage:"",sourceImageUrl:"",imgUrl:"",targetUrl:"",decorationCurrent:_[0],decorationList:_,border:{name:"圆角边框",value:"rect"},loading:!1},e}return _babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_5___default()(ProtraitApp,_Component),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default()(ProtraitApp,[{key:"componentDidMount",value:function(){var e=this,_=this.state.decorationCurrent;this.initCanvas(),this.handleMakeImage(null,_).then(function(_){e.setState({targetUrl:_})})}},{key:"initCanvas",value:function(){var e=this.refs.canvas;e.width=CANVANS_SIZE,e.height=CANVANS_SIZE}},{key:"handleChangeUpload",value:function(e){var _,t,a,r,n,i,c,l,s,o,u=this;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.async(function(E){for(;;)switch(E.prev=E.next){case 0:if(_=this.refs.canvas,t=_.getContext("2d"),a=e.target.files[0],r=this.state.decorationCurrent,a){E.next=6;break}return E.abrupt("return",!1);case 6:if(/image/gi.test(a.type)){E.next=9;break}return slucky_src_component_toast__WEBPACK_IMPORTED_MODULE_7__.a.warn("仅支持上传图片"),E.abrupt("return",!1);case 9:return this.setState({loading:!0}),E.next=12,_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.awrap(this.file2Base64(a));case 12:return n=E.sent,E.next=15,_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.awrap(this.createImage(n));case 15:i=E.sent,(c=i.width-i.height)>0?(l=i.width*CANVANS_SIZE/i.height,t.drawImage(i,0,0,l,CANVANS_SIZE)):c<0?(s=i.height*CANVANS_SIZE/i.width,t.drawImage(i,0,0,CANVANS_SIZE,s)):t.drawImage(i,0,0,CANVANS_SIZE,CANVANS_SIZE),o=_.toDataURL("image/png"),this.setState({imgUrl:o}),this.handleMakeImage(o,r).then(function(e){u.setState({targetUrl:e,loading:!1})});case 21:case"end":return E.stop()}},null,this)}},{key:"handleChangeDecorate",value:function(e){var _=this,t=this.state.imgUrl;this.setState({decorationCurrent:e,loading:!0}),this.handleMakeImage(t,e).then(function(e){_.setState({targetUrl:e,loading:!1})})}},{key:"handleChangeBorder",value:function(e){var _=this,t=this.state,a=t.imgUrl,r=t.decorationCurrent;this.setState({border:e,loading:!0},function(){_.handleMakeImage(a,r).then(function(e){_.setState({targetUrl:e,loading:!1})})})}},{key:"handleMakeImage",value:function(e,_){var t,a,r,n,i,c,l,s,o,u,E,p,d;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.async(function(h){for(;;)switch(h.prev=h.next){case 0:if(e||_){h.next=2;break}return h.abrupt("return","");case 2:if(t=this.state.border,a=t.value,r=_.source,n=_.style,i=n.width,c=n.height,l=n.top,s=n.left,o=this.refs.canvas,this.clearCanvas(o),u=o.getContext("2d"),!e){h.next=14;break}return h.next=12,_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.awrap(this.createImage(e));case 12:E=h.sent,u.drawImage(E,0,0,E.width,E.height);case 14:if(this.drawBorder(a,u),!_||!r){h.next=20;break}return h.next=18,_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.awrap(this.createImage(r));case 18:p=h.sent,u.drawImage(p,s,l,i,c);case 20:return d=o.toDataURL("image/png"),h.abrupt("return",d);case 22:case"end":return h.stop()}},null,this)}},{key:"drawBorder",value:function(e,_){var t={};switch(e){case"rect":t=this.Rect(-5,-5,CANVANS_SIZE+10,CANVANS_SIZE+10),this.drawUsingArc(t,40,_);break;case"circle":t=this.Rect(-22,-22,300,300),this.drawUsingArc(t,150,_,60)}}},{key:"Rect",value:function(e,_,t,a){return{x:e,y:_,width:t,height:a}}},{key:"drawUsingArc",value:function(e,_,t){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=new Path2D;r.moveTo(e.x+_,e.y),r.lineTo(e.x+e.width-_,e.y),r.arc(e.x+e.width-_,e.y+_,_,Math.PI/180*270,0,!1),r.lineTo(e.x+e.width,e.y+e.height-_),r.arc(e.x+e.width-_,e.y+e.height-_,_,0,Math.PI/180*90,0,!1),r.lineTo(e.x+_,e.y+e.height),r.arc(e.x+_,e.y+e.height-_,_,Math.PI/180*90,Math.PI/180*180,!1),r.lineTo(e.x,e.y+_),r.arc(e.x+_,e.y+_,_,Math.PI/180*180,Math.PI/180*270,!1),t.lineWidth=a,t.strokeStyle="#fff",t.stroke(r)}},{key:"file2Base64",value:function(e){return new Promise(function(_,t){var a=new FileReader;a.readAsDataURL(e),a.onload=function(e){_(a.result)}})}},{key:"createImage",value:function(e){return new Promise(function(_,t){var a=new Image;a.src=e,a.onload=function(e){_(a)}})}},{key:"clearCanvas",value:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}},{key:"downloadImage",value:function(e){if(!this.state.imgUrl)return slucky_src_component_toast__WEBPACK_IMPORTED_MODULE_7__.a.warn("请先上传头像"),!1;if(e){var _=document.createElement("a");document.createEvent("HTMLEvents").initEvent("click",!0,!0),_.download="protrait.png",_.href=e,_.click()}}},{key:"render",value:function(){var e=this,_=this.state,t=_.decorationList,a=_.targetUrl;_.imgUrl;return react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"d-f fullscreen ac app-bg"},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"w-full p-r z9"},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"fs18 ta-c pb32"},"制作你的专属头像"),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(slucky_src_component_lrChange__WEBPACK_IMPORTED_MODULE_8__.a,{option:t,onChange:function(_){return e.handleChangeDecorate(_)}},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"w256 h256 shadow p-r","loader-inline":this.state.loading?"circle":""},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("img",{src:a,alt:""}))),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(slucky_src_component_lrChange__WEBPACK_IMPORTED_MODULE_8__.a,{option:[{name:"圆角边框",value:"rect"},{name:"圆框",value:"circle"},{name:"无边框",value:""}],onChange:function(_){return e.handleChangeBorder(_)}},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"w256 ta-c pt32 pb8 fs18"},this.state.border.name)),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"ta-c pt32"},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"fileup-container mr8"},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"fileup"},react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("label",{htmlFor:"input_file",className:"fileup-in btn ptb4 plr16 c-text-w bg-theme"},"上传头像"),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("input",{type:"file",id:"input_file",ref:"upload_file",onChange:function(_){return e.handleChangeUpload(_)}}))),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("button",{className:"btn btn-w plr16 ptb4 ml8",onClick:function(){return e.downloadImage(a)}},"浏览器/PC端点击下载")),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div",{className:"c-hint-b ta-c pt16"},"移动端长按图片即可保存"),react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("canvas",{className:"w256 h256 shadow d-n",ref:"canvas"})))}},{key:"__reactstandin__regenerateByEval",value:function __reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}]),ProtraitApp}(react__WEBPACK_IMPORTED_MODULE_6__.Component),reactHotLoader,leaveModule;reactHotLoader=__webpack_require__("0cfB").default,leaveModule=__webpack_require__("0cfB").leaveModule,reactHotLoader&&(reactHotLoader.register(CANVANS_SIZE,"CANVANS_SIZE","/Users/flyteng/Desktop/workspace/project/sluckyUI/src/pages/protraitApp.jsx"),reactHotLoader.register(ProtraitApp,"ProtraitApp","/Users/flyteng/Desktop/workspace/project/sluckyUI/src/pages/protraitApp.jsx"),leaveModule(module))}.call(this,__webpack_require__("3UD+")(module))},FVwy:function(e,_,t){e.exports=t.p+"ff08fe482ed5a245552ef7183a6deaf1.png"},TiSE:function(e,_,t){e.exports=t.p+"6c7aac8227794f4d864fb10827c261d2.png"},Wq8K:function(e,_,t){e.exports=t.p+"14797f411529a1afc800b18ded5a0cf6.png"},lmTN:function(e,_,t){e.exports=t.p+"4dc66c602db4fd7ada4891f684f9a038.png"},nlqJ:function(e,_,t){}}]);