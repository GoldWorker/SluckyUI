(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"+NAl":function(e,_,t){e.exports=t.p+"3e4e3ec45bc2dc0939db7a32d1dcdf6d.png"},"3tZb":function(e,_,t){e.exports=t.p+"54ef72d9c775a1af9958793b4826a652.png"},"9mub":function(e,_,t){e.exports=t.p+"8d414daab2ea3370ecf4089c2911ab86.png"},EBIn:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){__webpack_require__.d(__webpack_exports__,"default",(function(){return ProtraitApp}));var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("o0o1"),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("yXPU"),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("lwsE"),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("W8MJ"),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("a1gu"),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("Nsbk"),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("7W2i"),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6__),react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("q1tI"),react__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_7__),slucky_src_component_toast__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("phJ6"),slucky_src_component_lrChange__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("jOWV"),_protraitApp_scss__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("nlqJ"),_protraitApp_scss__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_protraitApp_scss__WEBPACK_IMPORTED_MODULE_10__),enterModule;enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},CANVANS_SIZE=512,ProtraitApp=function(_Component){function ProtraitApp(){var e;_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2___default()(this,ProtraitApp),e=_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4___default()(this,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5___default()(ProtraitApp).call(this));var _=[{source:__webpack_require__("FVwy"),style:{width:CANVANS_SIZE/2,height:CANVANS_SIZE/2,top:"".concat(CANVANS_SIZE-CANVANS_SIZE/2),left:"".concat(CANVANS_SIZE-CANVANS_SIZE/2)}},{source:__webpack_require__("TiSE"),style:{width:CANVANS_SIZE/2,height:CANVANS_SIZE/2,top:"".concat(CANVANS_SIZE-276),left:0}},{source:__webpack_require__("kRou"),style:{width:1e3,height:1e3,top:-220,left:-220}},{source:__webpack_require__("gvuq"),style:{width:CANVANS_SIZE,height:CANVANS_SIZE,top:0,left:0}},{source:__webpack_require__("+NAl"),style:{width:CANVANS_SIZE,height:392,top:0,left:0}},{source:__webpack_require__("Wq8K"),style:{width:192,height:CANVANS_SIZE/2,top:"".concat(CANVANS_SIZE-CANVANS_SIZE/2),left:"".concat(CANVANS_SIZE-192)}},{source:__webpack_require__("3tZb"),style:{width:CANVANS_SIZE,height:192,top:-16,left:0}},{source:__webpack_require__("9mub"),style:{width:CANVANS_SIZE/2,height:240,top:"".concat(CANVANS_SIZE-240),left:"".concat(CANVANS_SIZE-CANVANS_SIZE/2)}},{source:__webpack_require__("lmTN"),style:{width:CANVANS_SIZE/2,height:CANVANS_SIZE/2,top:"".concat(CANVANS_SIZE-CANVANS_SIZE/2),left:"".concat(CANVANS_SIZE-CANVANS_SIZE/2)}},{source:"",style:{width:0,height:0,top:0,left:0}}];return e.state={sourceImage:"",sourceImageUrl:"",imgUrl:"",targetUrl:"",decorationCurrent:_[0],decorationList:_,border:{name:"圆角边框",value:"rect"},loading:!1},e}return _babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_6___default()(ProtraitApp,_Component),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3___default()(ProtraitApp,[{key:"componentDidMount",value:function(){var e=this,_=this.state.decorationCurrent;this.initCanvas(),this.handleMakeImage(null,_).then((function(_){e.setState({targetUrl:_})}))}},{key:"initCanvas",value:function(){var e=this.refs.canvas;e.width=CANVANS_SIZE,e.height=CANVANS_SIZE}},{key:"handleChangeUpload",value:(e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(_){var t,a,r,n,i,c,l,o,s,u,E=this;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.refs.canvas,a=t.getContext("2d"),r=_.target.files[0],n=this.state.decorationCurrent,r){e.next=6;break}return e.abrupt("return",!1);case 6:if(/image/gi.test(r.type)){e.next=9;break}return slucky_src_component_toast__WEBPACK_IMPORTED_MODULE_8__.a.warn("仅支持上传图片"),e.abrupt("return",!1);case 9:return this.setState({loading:!0}),e.next=12,this.file2Base64(r);case 12:return i=e.sent,e.next=15,this.createImage(i);case 15:c=e.sent,(l=c.width-c.height)>0?(o=c.width*CANVANS_SIZE/c.height,a.drawImage(c,0,0,o,CANVANS_SIZE)):l<0?(s=c.height*CANVANS_SIZE/c.width,a.drawImage(c,0,0,CANVANS_SIZE,s)):a.drawImage(c,0,0,CANVANS_SIZE,CANVANS_SIZE),u=t.toDataURL("image/png"),this.setState({imgUrl:u}),this.handleMakeImage(u,n).then((function(e){E.setState({targetUrl:e,loading:!1})}));case 21:case"end":return e.stop()}}),e,this)}))),function(_){return e.apply(this,arguments)})},{key:"handleChangeDecorate",value:function(e){var _=this,t=this.state.imgUrl;this.setState({decorationCurrent:e,loading:!0}),this.handleMakeImage(t,e).then((function(e){_.setState({targetUrl:e,loading:!1})}))}},{key:"handleChangeBorder",value:function(e){var _=this,t=this.state,a=t.imgUrl,r=t.decorationCurrent;this.setState({border:e,loading:!0},(function(){_.handleMakeImage(a,r).then((function(e){_.setState({targetUrl:e,loading:!1})}))}))}},{key:"handleMakeImage",value:function(){var e=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(_,t){var a,r,n,i,c,l,o,s,u,E,p,d,h;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_||t){e.next=2;break}return e.abrupt("return","");case 2:if(a=this.state.border,r=a.value,n=t.source,i=t.style,c=i.width,l=i.height,o=i.top,s=i.left,u=this.refs.canvas,this.clearCanvas(u),E=u.getContext("2d"),!_){e.next=14;break}return e.next=12,this.createImage(_);case 12:p=e.sent,E.drawImage(p,0,0,p.width,p.height);case 14:if(this.drawBorder(r,E),!t||!n){e.next=20;break}return e.next=18,this.createImage(n);case 18:d=e.sent,E.drawImage(d,s,o,c,l);case 20:return h=u.toDataURL("image/png"),e.abrupt("return",h);case 22:case"end":return e.stop()}}),e,this)})));return function(_,t){return e.apply(this,arguments)}}()},{key:"drawBorder",value:function(e,_){var t={};switch(e){case"rect":t=this.Rect(-10,-10,CANVANS_SIZE+20,CANVANS_SIZE+20),this.drawUsingArc(t,80,_,40);break;case"circle":t=this.Rect(-44,-44,600,600),this.drawUsingArc(t,300,_,120)}}},{key:"Rect",value:function(e,_,t,a){return{x:e,y:_,width:t,height:a}}},{key:"drawUsingArc",value:function(e,_,t){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=new Path2D;r.moveTo(e.x+_,e.y),r.lineTo(e.x+e.width-_,e.y),r.arc(e.x+e.width-_,e.y+_,_,Math.PI/180*270,0,!1),r.lineTo(e.x+e.width,e.y+e.height-_),r.arc(e.x+e.width-_,e.y+e.height-_,_,0,Math.PI/180*90,0,!1),r.lineTo(e.x+_,e.y+e.height),r.arc(e.x+_,e.y+e.height-_,_,Math.PI/180*90,Math.PI/180*180,!1),r.lineTo(e.x,e.y+_),r.arc(e.x+_,e.y+_,_,Math.PI/180*180,Math.PI/180*270,!1),t.lineWidth=a,t.strokeStyle="#fff",t.stroke(r)}},{key:"file2Base64",value:function(e){return new Promise((function(_,t){var a=new FileReader;a.readAsDataURL(e),a.onload=function(e){_(a.result)}}))}},{key:"createImage",value:function(e){return new Promise((function(_,t){var a=new Image;a.src=e,a.onload=function(e){_(a)}}))}},{key:"clearCanvas",value:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}},{key:"downloadImage",value:function(e){if(!this.state.imgUrl)return slucky_src_component_toast__WEBPACK_IMPORTED_MODULE_8__.a.warn("请先上传头像"),!1;if(e){var _=document.createElement("a");document.createEvent("HTMLEvents").initEvent("click",!0,!0),_.download="protrait.png",_.href=e,_.click()}}},{key:"render",value:function(){var e=this,_=this.state,t=_.decorationList,a=_.targetUrl;_.imgUrl;return react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"d-f fullscreen ac app-bg"},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"w-full p-r z9"},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"fs18 ta-c pb32"},"制作你的专属头像"),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement(slucky_src_component_lrChange__WEBPACK_IMPORTED_MODULE_9__.a,{option:t,onChange:function(_){return e.handleChangeDecorate(_)}},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"w256 h256 shadow p-r","loader-inline":this.state.loading?"circle":""},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("img",{className:"w256 h256",src:a,alt:""}))),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement(slucky_src_component_lrChange__WEBPACK_IMPORTED_MODULE_9__.a,{option:[{name:"圆角边框",value:"rect"},{name:"圆框",value:"circle"},{name:"无边框",value:""}],onChange:function(_){return e.handleChangeBorder(_)}},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"w256 ta-c pt32 pb8 fs18"},this.state.border.name)),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"ta-c pt32"},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"fileup-container mr8"},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"fileup"},react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("label",{htmlFor:"input_file",className:"fileup-in btn ptb4 plr16 c-text-w bg-theme"},"上传头像"),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("input",{type:"file",id:"input_file",ref:"upload_file",onChange:function(_){return e.handleChangeUpload(_)}}))),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("button",{className:"btn btn-w plr16 ptb4 ml8",onClick:function(){return e.downloadImage(a)}},"浏览器/PC端点击下载")),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("div",{className:"c-hint-b ta-c pt16"},"移动端长按图片即可保存"),react__WEBPACK_IMPORTED_MODULE_7___default.a.createElement("canvas",{width:"512",height:"512",className:"shadow d-n",ref:"canvas"})))}},{key:"__reactstandin__regenerateByEval",value:function __reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}]),ProtraitApp;var e}(react__WEBPACK_IMPORTED_MODULE_7__.Component),reactHotLoader,leaveModule;reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(CANVANS_SIZE,"CANVANS_SIZE","/Users/flyteng/Desktop/workspace/project/sluckyUI/src/pages/protraitApp.jsx"),reactHotLoader.register(ProtraitApp,"ProtraitApp","/Users/flyteng/Desktop/workspace/project/sluckyUI/src/pages/protraitApp.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}.call(this,__webpack_require__("3UD+")(module))},FVwy:function(e,_,t){e.exports=t.p+"389f910dcaff0aa443055f4e16cc6dd7.png"},TiSE:function(e,_,t){e.exports=t.p+"68eac0dc7c7e2898d89ec443516488ea.png"},Wq8K:function(e,_,t){e.exports=t.p+"c7deb12e2bf5b563efb787085365e838.png"},gvuq:function(e,_,t){e.exports=t.p+"d8ff5b1f0c07ecfec2cadb315e9b5b66.png"},kRou:function(e,_,t){e.exports=t.p+"93b761188abed32195d14531424907bb.png"},lmTN:function(e,_,t){e.exports=t.p+"952750dad8a454db7f6de05d78b300fd.png"},nlqJ:function(e,_,t){}}]);